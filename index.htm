<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Happy Birthday Lenard</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #111;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>

<canvas id="c"></canvas>

<script>
const c = document.getElementById("c");
let w = (c.width = window.innerWidth),
    h = (c.height = window.innerHeight),
    ctx = c.getContext("2d"),
    hw = w / 2,
    hh = h / 2;

let opts = {
  strings: ["HAPPY", "BIRTHDAY", "LENARD"],
  charSize: 30,
  charSpacing: 35,
  lineHeight: 40,

  fireworkPrevPoints: 10,
  fireworkBaseLineWidth: 5,
  fireworkAddedLineWidth: 8,
  fireworkSpawnTime: 200,
  fireworkBaseReachTime: 30,
  fireworkAddedReachTime: 30,
  fireworkCircleBaseSize: 20,
  fireworkCircleAddedSize: 10,
  fireworkCircleBaseTime: 30,
  fireworkCircleAddedTime: 30,
  fireworkCircleFadeBaseTime: 10,
  fireworkCircleFadeAddedTime: 5,
  fireworkBaseShards: 5,
  fireworkAddedShards: 5,
  fireworkShardPrevPoints: 3,
  fireworkShardBaseVel: 4,
  fireworkShardAddedVel: 2,
  fireworkShardBaseSize: 3,
  fireworkShardAddedSize: 3,
  gravity: 0.1,
  upFlow: -0.1,
  letterContemplatingWaitTime: 360,
  balloonSpawnTime: 20,
  balloonBaseInflateTime: 10,
  balloonAddedInflateTime: 10,
  balloonBaseSize: 20,
  balloonAddedSize: 20,
  balloonBaseVel: 0.4,
  balloonAddedVel: 0.4,
  balloonBaseRadian: -(Math.PI / 2 - 0.5),
  balloonAddedRadian: -1,
};

let Tau = Math.PI * 2;
let TauQuarter = Tau / 4;
let letters = [];

ctx.font = opts.charSize + "px Verdana";

function Letter(char, x, y) {
  this.char = char;
  this.x = x;
  this.y = y;
  this.dx = -ctx.measureText(char).width / 2;
  this.dy = opts.charSize / 2;
  this.fireworkDy = this.y - hh;

  let hue = (x / (opts.charSpacing * 10)) * 360;
  this.color = `hsl(${hue},80%,50%)`;
  this.alphaColor = `hsla(${hue},80%,50%,alp)`;
  this.lightColor = `hsl(${hue},80%,70%)`;

  this.reset();
}

Letter.prototype.reset = function () {
  this.phase = "firework";
  this.tick = 0;
  this.spawned = false;
  this.spawningTime = (opts.fireworkSpawnTime * Math.random()) | 0;
  this.reachTime = (opts.fireworkBaseReachTime + opts.fireworkAddedReachTime * Math.random()) | 0;
  this.prevPoints = [[0, hh, 0]];
};

Letter.prototype.step = function () {
  if (this.phase === "firework") {
    if (!this.spawned) {
      if (++this.tick >= this.spawningTime) {
        this.tick = 0;
        this.spawned = true;
      }
    } else {
      ++this.tick;
      let p = this.tick / this.reachTime;
      let x = p * this.x;
      let y = hh + Math.sin(p * TauQuarter) * this.fireworkDy;
      this.prevPoints.push([x, y]);

      for (let i = 1; i < this.prevPoints.length; i++) {
        ctx.strokeStyle = this.alphaColor.replace("alp", i / this.prevPoints.length);
        ctx.beginPath();
        ctx.moveTo(this.prevPoints[i - 1][0], this.prevPoints[i - 1][1]);
        ctx.lineTo(this.prevPoints[i][0], this.prevPoints[i][1]);
        ctx.stroke();
      }

      if (this.tick >= this.reachTime) this.phase = "done";
    }
  } else {
    ctx.fillStyle = this.lightColor;
    ctx.fillText(this.char, this.x + this.dx + hw, this.y + this.dy + hh);
  }
};

function anim() {
  requestAnimationFrame(anim);
  ctx.fillStyle = "#111";
  ctx.fillRect(0, 0, w, h);

  let i = 0;
  opts.strings.forEach((line, row) => {
    for (let col = 0; col < line.length; col++) {
      if (!letters[i]) {
        letters[i] = new Letter(
          line[col],
          col * opts.charSpacing - (line.length * opts.charSpacing) / 2,
          row * opts.lineHeight - (opts.strings.length * opts.lineHeight) / 2
        );
      }
      letters[i].step();
      i++;
    }
  });
}

anim();

window.addEventListener("resize", () => {
  w = c.width = window.innerWidth;
  h = c.height = window.innerHeight;
  hw = w / 2;
  hh = h / 2;
});
</script>

</body>
</html>
